{"ast":null,"code":"import _toConsumableArray from\"C:/Projects/Mod_App_Front/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"C:/Projects/Mod_App_Front/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Projects/Mod_App_Front/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Projects\\\\Mod_App_Front\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState,useEffect}from\"react\";import axios from\"axios\";import{TextField,Button,Select,MenuItem,InputLabel,FormControl,Typography,Container,Paper,List,ListItem,ListItemText,CircularProgress}from\"@mui/material\";import{auth,GoogleAuthProvider,signInWithPopup}from\"./firebase\";import\"./YouTubeComments.css\";// Import the new CSS file\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var YouTubeComments=function YouTubeComments(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),videoId=_useState2[0],setVideoId=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),commentAuthors=_useState4[0],setCommentAuthors=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),accessToken=_useState6[0],setAccessToken=_useState6[1];var _useState7=useState(10),_useState8=_slicedToArray(_useState7,2),maxResults=_useState8[0],setMaxResults=_useState8[1];// Default to 10 comments per request\nvar _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),error=_useState10[0],setError=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),loading=_useState12[0],setLoading=_useState12[1];useEffect(function(){var unsubscribe=auth.onAuthStateChanged(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(user){var token;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!user){_context.next=16;break;}_context.prev=1;console.log(\"User is authenticated:\",user);_context.next=5;return user.getIdToken(true);case 5:token=_context.sent;// Force refresh the token\nconsole.log(\"Access Token:\",token);setAccessToken(token);_context.next=14;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](1);console.error(\"Error getting token:\",_context.t0);setError(\"Failed to authenticate with Google. Please try again.\");case 14:_context.next=18;break;case 16:console.log(\"User is not authenticated. Initiating authentication...\");setAccessToken(null);case 18:case\"end\":return _context.stop();}}},_callee,null,[[1,10]]);}));return function(_x){return _ref.apply(this,arguments);};}());// Cleanup subscription on unmount\nreturn function(){return unsubscribe();};},[]);var extractVideoId=function extractVideoId(input){try{var urlObj=new URL(input);var params=new URLSearchParams(urlObj.search);if(params.has(\"v\")){return params.get(\"v\");}// Handle other YouTube URL formats if necessary\nvar pathname=urlObj.pathname;if(pathname.startsWith(\"/embed/\")){return pathname.split(\"/embed/\")[1];}if(pathname.startsWith(\"/v/\")){return pathname.split(\"/v/\")[1];}if(pathname.startsWith(\"/watch\")){return params.get(\"v\");}return input;}catch(e){// If input is not a valid URL, assume it's a plain video ID\nreturn input;}};var handleAuth=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var provider,result,token;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:provider=new GoogleAuthProvider();_context2.prev=1;_context2.next=4;return signInWithPopup(auth,provider);case 4:result=_context2.sent;_context2.next=7;return result.user.getIdToken(true);case 7:token=_context2.sent;console.log(\"Authentication successful. Access Token:\",token);setAccessToken(token);return _context2.abrupt(\"return\",token);case 13:_context2.prev=13;_context2.t0=_context2[\"catch\"](1);console.error(\"Error during sign-in:\",_context2.t0);setError(\"Failed to authenticate with Google. Please try again.\");return _context2.abrupt(\"return\",null);case 18:case\"end\":return _context2.stop();}}},_callee2,null,[[1,13]]);}));return function handleAuth(){return _ref2.apply(this,arguments);};}();var fetchComments=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var token,validVideoId,response,commentThreads,authors;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setError(null);setLoading(true);token=accessToken;if(token){_context3.next=8;break;}console.log(\"No access token found. Initiating authentication...\");_context3.next=7;return handleAuth();case 7:token=_context3.sent;case 8:if(token){_context3.next=11;break;}setLoading(false);return _context3.abrupt(\"return\");case 11:validVideoId=extractVideoId(videoId);console.log(\"Fetching comments for video ID:\",validVideoId);_context3.prev=13;_context3.next=16;return axios.post(\"https://youtube-comments-backend-23opjzqi7q-uc.a.run.app/youtube/comments\",{videoId:validVideoId,accessToken:token,maxResults:maxResults});case 16:response=_context3.sent;console.log(\"Comments fetched successfully:\",response.data);commentThreads=response.data;authors=commentThreads.flatMap(function(thread){return[thread.snippet.topLevelComment.snippet.authorDisplayName].concat(_toConsumableArray(thread.replies?thread.replies.comments.map(function(reply){return reply.snippet.authorDisplayName;}):[]));});setCommentAuthors(authors);setLoading(false);_context3.next=35;break;case 24:_context3.prev=24;_context3.t0=_context3[\"catch\"](13);console.error(\"Error fetching comment threads\",_context3.t0);if(!(_context3.t0.response&&_context3.t0.response.status===401)){_context3.next=33;break;}setError(\"Session expired. Please re-authenticate.\");_context3.next=31;return handleAuth();case 31:_context3.next=34;break;case 33:if(_context3.t0.response&&_context3.t0.response.status===404){setError(\"Video not found\");}else{setError(\"Failed to fetch comments. Please try again.\");}case 34:setLoading(false);case 35:case\"end\":return _context3.stop();}}},_callee3,null,[[13,24]]);}));return function fetchComments(){return _ref3.apply(this,arguments);};}();var selectWinner=function selectWinner(){if(commentAuthors.length===0)return;var winner=commentAuthors[Math.floor(Math.random()*commentAuthors.length)];alert(\"The winner is: \".concat(winner));};return/*#__PURE__*/_jsx(Container,{component:Paper,elevation:3,sx:{padding:4,marginTop:4},children:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"YouTube Comment Picker\"}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"YouTube Video URL or ID\",variant:\"outlined\",value:videoId,onChange:function onChange(e){return setVideoId(e.target.value);},margin:\"normal\"}),/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,variant:\"outlined\",margin:\"normal\",children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Max Results\"}),/*#__PURE__*/_jsxs(Select,{value:maxResults,onChange:function onChange(e){return setMaxResults(Number(e.target.value));},label:\"Max Results\",children:[/*#__PURE__*/_jsx(MenuItem,{value:10,children:\"10\"}),/*#__PURE__*/_jsx(MenuItem,{value:15,children:\"15\"}),/*#__PURE__*/_jsx(MenuItem,{value:25,children:\"25\"}),/*#__PURE__*/_jsx(MenuItem,{value:50,children:\"50\"}),/*#__PURE__*/_jsx(MenuItem,{value:100,children:\"100\"})]})]}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:fetchComments,disabled:loading,children:\"Fetch Comments\"}),loading&&/*#__PURE__*/_jsx(CircularProgress,{sx:{marginTop:2}}),error&&/*#__PURE__*/_jsx(Typography,{color:\"error\",sx:{marginTop:2},children:error}),/*#__PURE__*/_jsx(List,{sx:{marginTop:2,maxHeight:400,overflow:'auto'},children:commentAuthors.map(function(author,index){return/*#__PURE__*/_jsx(ListItem,{children:/*#__PURE__*/_jsx(ListItemText,{primary:author})},index);})}),commentAuthors.length>0&&/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"secondary\",onClick:selectWinner,sx:{marginTop:2},children:\"Select Winner\"})]})});};export default YouTubeComments;","map":{"version":3,"sources":["C:/Projects/Mod_App_Front/src/components/YouTubeComments.js"],"names":["React","useState","useEffect","axios","TextField","Button","Select","MenuItem","InputLabel","FormControl","Typography","Container","Paper","List","ListItem","ListItemText","CircularProgress","auth","GoogleAuthProvider","signInWithPopup","YouTubeComments","videoId","setVideoId","commentAuthors","setCommentAuthors","accessToken","setAccessToken","maxResults","setMaxResults","error","setError","loading","setLoading","unsubscribe","onAuthStateChanged","user","console","log","getIdToken","token","extractVideoId","input","urlObj","URL","params","URLSearchParams","search","has","get","pathname","startsWith","split","e","handleAuth","provider","result","fetchComments","validVideoId","post","response","data","commentThreads","authors","flatMap","thread","snippet","topLevelComment","authorDisplayName","replies","comments","map","reply","status","selectWinner","length","winner","Math","floor","random","alert","padding","marginTop","target","value","Number","maxHeight","overflow","author","index"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport { TextField, Button, Select, MenuItem, InputLabel, FormControl, Typography, Container, Paper, List, ListItem, ListItemText, CircularProgress } from \"@mui/material\";\r\nimport { auth, GoogleAuthProvider, signInWithPopup } from \"./firebase\";\r\nimport \"./YouTubeComments.css\"; // Import the new CSS file\r\n\r\nconst YouTubeComments = () => {\r\n  const [videoId, setVideoId] = useState(\"\");\r\n  const [commentAuthors, setCommentAuthors] = useState([]);\r\n  const [accessToken, setAccessToken] = useState(\"\");\r\n  const [maxResults, setMaxResults] = useState(10); // Default to 10 comments per request\r\n  const [error, setError] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const unsubscribe = auth.onAuthStateChanged(async (user) => {\r\n      if (user) {\r\n        try {\r\n          console.log(\"User is authenticated:\", user);\r\n          const token = await user.getIdToken(true); // Force refresh the token\r\n          console.log(\"Access Token:\", token);\r\n          setAccessToken(token);\r\n        } catch (error) {\r\n          console.error(\"Error getting token:\", error);\r\n          setError(\"Failed to authenticate with Google. Please try again.\");\r\n        }\r\n      } else {\r\n        console.log(\"User is not authenticated. Initiating authentication...\");\r\n        setAccessToken(null);\r\n      }\r\n    });\r\n\r\n    // Cleanup subscription on unmount\r\n    return () => unsubscribe();\r\n  }, []);\r\n\r\n  const extractVideoId = (input) => {\r\n    try {\r\n      const urlObj = new URL(input);\r\n      const params = new URLSearchParams(urlObj.search);\r\n      if (params.has(\"v\")) {\r\n        return params.get(\"v\");\r\n      }\r\n      // Handle other YouTube URL formats if necessary\r\n      const pathname = urlObj.pathname;\r\n      if (pathname.startsWith(\"/embed/\")) {\r\n        return pathname.split(\"/embed/\")[1];\r\n      }\r\n      if (pathname.startsWith(\"/v/\")) {\r\n        return pathname.split(\"/v/\")[1];\r\n      }\r\n      if (pathname.startsWith(\"/watch\")) {\r\n        return params.get(\"v\");\r\n      }\r\n      return input;\r\n    } catch (e) {\r\n      // If input is not a valid URL, assume it's a plain video ID\r\n      return input;\r\n    }\r\n  };\r\n\r\n  const handleAuth = async () => {\r\n    const provider = new GoogleAuthProvider();\r\n    try {\r\n      const result = await signInWithPopup(auth, provider);\r\n      const token = await result.user.getIdToken(true);\r\n      console.log(\"Authentication successful. Access Token:\", token);\r\n      setAccessToken(token);\r\n      return token;\r\n    } catch (error) {\r\n      console.error(\"Error during sign-in:\", error);\r\n      setError(\"Failed to authenticate with Google. Please try again.\");\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const fetchComments = async () => {\r\n    setError(null);\r\n    setLoading(true);\r\n\r\n    let token = accessToken;\r\n    if (!token) {\r\n      console.log(\"No access token found. Initiating authentication...\");\r\n      token = await handleAuth();\r\n    }\r\n\r\n    if (!token) {\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    const validVideoId = extractVideoId(videoId);\r\n    console.log(\"Fetching comments for video ID:\", validVideoId);\r\n    try {\r\n      const response = await axios.post(\"https://youtube-comments-backend-23opjzqi7q-uc.a.run.app/youtube/comments\", {\r\n        videoId: validVideoId,\r\n        accessToken: token,\r\n        maxResults,\r\n      });\r\n      console.log(\"Comments fetched successfully:\", response.data);\r\n      const commentThreads = response.data;\r\n      const authors = commentThreads.flatMap(thread => [\r\n        thread.snippet.topLevelComment.snippet.authorDisplayName,\r\n        ...(thread.replies ? thread.replies.comments.map(reply => reply.snippet.authorDisplayName) : [])\r\n      ]);\r\n      setCommentAuthors(authors);\r\n      setLoading(false);\r\n    } catch (error) {\r\n      console.error(\"Error fetching comment threads\", error);\r\n      if (error.response && error.response.status === 401) {\r\n        setError(\"Session expired. Please re-authenticate.\");\r\n        await handleAuth(); // Prompt re-authentication\r\n      } else if (error.response && error.response.status === 404) {\r\n        setError(\"Video not found\");\r\n      } else {\r\n        setError(\"Failed to fetch comments. Please try again.\");\r\n      }\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const selectWinner = () => {\r\n    if (commentAuthors.length === 0) return;\r\n    const winner = commentAuthors[Math.floor(Math.random() * commentAuthors.length)];\r\n    alert(`The winner is: ${winner}`);\r\n  };\r\n\r\n  return (\r\n    <Container component={Paper} elevation={3} sx={{ padding: 4, marginTop: 4 }}>\r\n      <>\r\n        <Typography variant=\"h5\" gutterBottom>\r\n          YouTube Comment Picker\r\n        </Typography>\r\n        <TextField\r\n          fullWidth\r\n          label=\"YouTube Video URL or ID\"\r\n          variant=\"outlined\"\r\n          value={videoId}\r\n          onChange={(e) => setVideoId(e.target.value)}\r\n          margin=\"normal\"\r\n        />\r\n        <FormControl fullWidth variant=\"outlined\" margin=\"normal\">\r\n          <InputLabel>Max Results</InputLabel>\r\n          <Select value={maxResults} onChange={(e) => setMaxResults(Number(e.target.value))} label=\"Max Results\">\r\n            <MenuItem value={10}>10</MenuItem>\r\n            <MenuItem value={15}>15</MenuItem>\r\n            <MenuItem value={25}>25</MenuItem>\r\n            <MenuItem value={50}>50</MenuItem>\r\n            <MenuItem value={100}>100</MenuItem>\r\n          </Select>\r\n        </FormControl>\r\n        <Button variant=\"contained\" color=\"primary\" onClick={fetchComments} disabled={loading}>\r\n          Fetch Comments\r\n        </Button>\r\n        {loading && <CircularProgress sx={{ marginTop: 2 }} />}\r\n        {error && <Typography color=\"error\" sx={{ marginTop: 2 }}>{error}</Typography>}\r\n        <List sx={{ marginTop: 2, maxHeight: 400, overflow: 'auto' }}>\r\n          {commentAuthors.map((author, index) => (\r\n            <ListItem key={index}>\r\n              <ListItemText primary={author} />\r\n            </ListItem>\r\n          ))}\r\n        </List>\r\n        {commentAuthors.length > 0 && (\r\n          <Button variant=\"contained\" color=\"secondary\" onClick={selectWinner} sx={{ marginTop: 2 }}>\r\n            Select Winner\r\n          </Button>\r\n        )}\r\n      </>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default YouTubeComments;\r\n"]},"metadata":{},"sourceType":"module"}